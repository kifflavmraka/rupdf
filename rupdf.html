<html>
  <head>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.4.1/jspdf.debug.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/2.3.4/jspdf.plugin.autotable.min.js"></script>
  </head>
  <body>
    <div>
      <h1>Ru's Magic PDF Generator</h1>
      <a href="http://kifflavmraka.github.com/rupdf/README.md">README & examples</a>

      <br>

      <textarea
        id="csv"
        cols="100"
        rows="20"
      >name,family</textarea>
      <br>

      <p>Paste HTML template here. Placeholders should be in {{ $variable_name }} format </p>
      <textarea id="template" cols="100" rows="30"></textarea>

      <br>

      <button id="submit">Submit CSV</button>
    </div>

    <script>
      $('#submit').on('click', function(e) {

        const csvInput = $('textarea#csv').val();
        const templateInput = $('textarea#template').val();

        let [placeholders, ...rows] = csvInput.split('\n');
        placeholders = placeholders.split(',');

        rows.forEach(row => {
          let template = templateInput;
          const values = row.split(',');
          values.forEach((val, idx) => {
            template = template.replaceAll(`{{ $${ placeholders[idx] } }}`, val);
          });


          const doc = new jsPDF();

          doc.fromHTML(template);
          doc.save(`${Date.now()}-${values[0]}-${values[1]}.pdf`);
        });

      });
    </script>
  </body>
</html>
